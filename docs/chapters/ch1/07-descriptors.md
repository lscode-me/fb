# –ì–ª–∞–≤–∞ 7. –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –∏ –ø–æ—Ç–æ–∫–∏

## –í–≤–µ–¥–µ–Ω–∏–µ

–î–æ —Å–∏—Ö –ø–æ—Ä –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –æ —Ñ–∞–π–ª–∞—Ö –∫–∞–∫ –æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–∞—Ö –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ. –ù–æ –∫–∞–∫ **–ø—Ä–æ—Ü–µ—Å—Å—ã** —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ñ–∞–π–ª–∞–º–∏? –ö–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —á–∏—Ç–∞–µ—Ç –∏ –ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ?

–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **—Ñ–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã** (file descriptors, fd).

!!! note "–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è"
    –§–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä ‚Äî —ç—Ç–æ **—á–∏—Å–ª–æ**, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ—Ü–µ—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É —Ñ–∞–π–ª—É. –≠—Ç–æ —É—Ä–æ–≤–µ–Ω—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –º–µ–∂–¥—É –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –∏ —è–¥—Ä–æ–º.

### –ü—É—Ç—å –±–∞–π—Ç–∞: –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ –¥–∏—Å–∫–∞

```mermaid
graph TD
    A["–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ<br/><code>read(fd, buf, n)</code>"] --> B["–§–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä<br/>(fd table –ø—Ä–æ—Ü–µ—Å—Å–∞)"]
    B --> C["Open File Table<br/>(—Å–∏—Å—Ç–µ–º–Ω–∞—è, –æ–±—â–∞—è)"]
    C --> D["VFS<br/>(Virtual File System)"]
    D --> E{"–î—Ä–∞–π–≤–µ—Ä –§–°"}
    E --> F["ext4 / XFS / Btrfs"]
    E --> G["NTFS / APFS"]
    E --> H["NFS / SMB"]
    F --> I["Block Device Layer"]
    G --> I
    H --> J["–°–µ—Ç—å"]
    I --> K["–î—Ä–∞–π–≤–µ—Ä –¥–∏—Å–∫–∞<br/>(SCSI / NVMe)"]
    K --> L["üíæ –§–∏–∑–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫"]

    style A fill:#e1f5fe
    style D fill:#fff3e0
    style L fill:#e8f5e9
```

---

## 7.1 –ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**–§–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä (fd)** ‚Äî —ç—Ç–æ –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ, –∫–æ—Ç–æ—Ä–æ–µ —è–¥—Ä–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–º—É —Ñ–∞–π–ª—É –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å–∞.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –ü—Ä–æ—Ü–µ—Å—Å (PID 1234)                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –¢–∞–±–ª–∏—Ü–∞ —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤:                             ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ    fd ‚îÇ –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞                                        ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ              ‚îÇ
‚îÇ    0  ‚îÇ ‚Üí stdin  (—Ç–µ—Ä–º–∏–Ω–∞–ª /dev/pts/0)                      ‚îÇ
‚îÇ    1  ‚îÇ ‚Üí stdout (—Ç–µ—Ä–º–∏–Ω–∞–ª /dev/pts/0)                      ‚îÇ
‚îÇ    2  ‚îÇ ‚Üí stderr (—Ç–µ—Ä–º–∏–Ω–∞–ª /dev/pts/0)                      ‚îÇ
‚îÇ    3  ‚îÇ ‚Üí /home/user/data.txt (–æ—Ç–∫—Ä—ã—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è)           ‚îÇ
‚îÇ    4  ‚îÇ ‚Üí /var/log/app.log (–æ—Ç–∫—Ä—ã—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏)              ‚îÇ
‚îÇ    5  ‚îÇ ‚Üí socket (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã

–ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ–ª—É—á–∞–µ—Ç —Ç—Ä–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞:

| fd | –ò–º—è | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----|-----|-----------|------------|
| 0 | stdin | STDIN_FILENO | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥ (standard input) |
| 1 | stdout | STDOUT_FILENO | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ (standard output) |
| 2 | stderr | STDERR_FILENO | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ –æ—à–∏–±–æ–∫ (standard error) |

=== "Linux"

    ```bash
    # –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ shell-–ø—Ä–æ—Ü–µ—Å—Å–∞
    $ ls -l /proc/$$/fd
    lrwx------ 1 user user 64 Feb  4 10:00 0 -> /dev/pts/0
    lrwx------ 1 user user 64 Feb  4 10:00 1 -> /dev/pts/0
    lrwx------ 1 user user 64 Feb  4 10:00 2 -> /dev/pts/0
    
    # –ò–ª–∏ —á–µ—Ä–µ–∑ lsof
    $ lsof -p $$
    ```

=== "FreeBSD / macOS"

    ```bash
    # –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ fstat
    $ fstat -p $$
    USER     CMD          PID   FD MOUNT      INUM MODE
    user     bash        1234    0 /dev         12 crw--w----
    user     bash        1234    1 /dev         12 crw--w----
    user     bash        1234    2 /dev         12 crw--w----
    
    # –ò–ª–∏ —á–µ—Ä–µ–∑ lsof (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –Ω–∞ FreeBSD)
    $ lsof -p $$
    ```

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞

```
open() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ close()
   ‚îÇ               ‚îÇ                    ‚îÇ
   ‚îÇ               ‚îÇ                    ‚îÇ
   ‚ñº               ‚ñº                    ‚ñº
—è–¥—Ä–æ –≤—ã–¥–µ–ª—è–µ—Ç   read(fd, ...)      —è–¥—Ä–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç
   fd           write(fd, ...)          fd
```

---

## 7.2 –û—Ç–∫—Ä—ã—Ç–∏–µ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤

### –°–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ open()

```c
#include <fcntl.h>

// –û—Ç–∫—Ä—ã—Ç—å –¥–ª—è —á—Ç–µ–Ω–∏—è
int fd = open("file.txt", O_RDONLY);

// –û—Ç–∫—Ä—ã—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏ (—Å–æ–∑–¥–∞—Ç—å –µ—Å–ª–∏ –Ω–µ—Ç, –æ–±—Ä–µ–∑–∞—Ç—å –µ—Å–ª–∏ –µ—Å—Ç—å)
int fd = open("file.txt", O_WRONLY | O_CREAT | O_TRUNC, 0644);

// –û—Ç–∫—Ä—ã—Ç—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
int fd = open("log.txt", O_WRONLY | O_CREAT | O_APPEND, 0644);

// –ó–∞–∫—Ä—ã—Ç—å
close(fd);
```

**–§–ª–∞–≥–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è:**

| –§–ª–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| O_RDONLY | –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ |
| O_WRONLY | –¢–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å |
| O_RDWR | –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å |
| O_CREAT | –°–æ–∑–¥–∞—Ç—å –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç |
| O_TRUNC | –û–±—Ä–µ–∑–∞—Ç—å –¥–æ –Ω—É–ª—è |
| O_APPEND | –ü–∏—Å–∞—Ç—å –≤ –∫–æ–Ω–µ—Ü |
| O_EXCL | –û—à–∏–±–∫–∞ –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (—Å O_CREAT) |

### Python: open() –∏ —Ñ–∞–π–ª–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã

```python
# –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
with open('file.txt', 'r') as f:
    content = f.read()

# –ü–æ–ª—É—á–∏—Ç—å fd –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
f = open('file.txt', 'r')
print(f.fileno())  # 3 (–∏–ª–∏ –¥—Ä—É–≥–æ–µ —á–∏—Å–ª–æ)
f.close()

# –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API (os module)
import os
fd = os.open('file.txt', os.O_RDONLY)
data = os.read(fd, 1024)
os.close(fd)
```

### –ù—É–º–µ—Ä–∞—Ü–∏—è –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

–Ø–¥—Ä–æ –≤—Å–µ–≥–¥–∞ –≤—ã–¥–µ–ª—è–µ—Ç **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–≤–æ–±–æ–¥–Ω—ã–π –Ω–æ–º–µ—Ä**:

```python
import os

fd1 = os.open('a.txt', os.O_RDONLY)  # fd = 3
fd2 = os.open('b.txt', os.O_RDONLY)  # fd = 4
fd3 = os.open('c.txt', os.O_RDONLY)  # fd = 5

os.close(fd2)  # –û—Å–≤–æ–±–æ–¥–∏–ª–∏ fd = 4

fd4 = os.open('d.txt', os.O_RDONLY)  # fd = 4 (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!)
```

---

## 7.3 –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã read() –∏ write()

```c
#include <unistd.h>

char buffer[1024];

// –ß—Ç–µ–Ω–∏–µ: –≤–µ—Ä–Ω—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –±–∞–π—Ç
ssize_t bytes_read = read(fd, buffer, sizeof(buffer));

// –ó–∞–ø–∏—Å—å: –≤–µ—Ä–Ω—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –±–∞–π—Ç
ssize_t bytes_written = write(fd, "Hello", 5);
```

### –ü–æ–∑–∏—Ü–∏—è –≤ —Ñ–∞–π–ª–µ (file offset)

–ö–∞–∂–¥—ã–π –æ—Ç–∫—Ä—ã—Ç—ã–π —Ñ–∞–π–ª –∏–º–µ–µ—Ç —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é:

```c
#include <unistd.h>

// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
off_t pos = lseek(fd, 0, SEEK_CUR);

// –ü–µ—Ä–µ–π—Ç–∏ –≤ –Ω–∞—á–∞–ª–æ
lseek(fd, 0, SEEK_SET);

// –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ–Ω–µ—Ü
lseek(fd, 0, SEEK_END);

// –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ 100 –±–∞–π—Ç –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
lseek(fd, 100, SEEK_CUR);
```

```python
# Python
f = open('file.txt', 'r')
f.tell()        # –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è
f.seek(0)       # –í –Ω–∞—á–∞–ª–æ
f.seek(0, 2)    # –í –∫–æ–Ω–µ—Ü (2 = SEEK_END)
f.seek(100, 1)  # +100 –æ—Ç —Ç–µ–∫—É—â–µ–π (1 = SEEK_CUR)
```

---

## 7.4 –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ Shell

### –ë–∞–∑–æ–≤–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å stdout –≤ —Ñ–∞–π–ª
$ command > output.txt

# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å stdout (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ)
$ command >> output.txt

# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å stdin –∏–∑ —Ñ–∞–π–ª–∞
$ command < input.txt

# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å stderr –≤ —Ñ–∞–π–ª
$ command 2> errors.txt

# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å stdout –∏ stderr –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª
$ command > all.txt 2>&1
$ command &> all.txt      # Bash shortcut
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏

```bash
$ echo "Hello" > output.txt

# Shell –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
# 1. fork() ‚Äî —Å–æ–∑–¥–∞—ë—Ç –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å
# 2. –í –¥–æ—á–µ—Ä–Ω–µ–º –ø—Ä–æ—Ü–µ—Å—Å–µ:
#    close(1)                      # –ó–∞–∫—Ä—ã—Ç—å stdout
#    open("output.txt", O_WRONLY|O_CREAT|O_TRUNC, 0644)  # –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª (–ø–æ–ª—É—á–∏—Ç fd=1!)
# 3. exec("echo", "Hello")        # –ó–∞–ø—É—Å—Ç–∏—Ç—å echo
# 4. echo –ø–∏—à–µ—Ç –≤ fd=1, –Ω–µ –∑–Ω–∞—è —á—Ç–æ —ç—Ç–æ —Ñ–∞–π–ª
```

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

```bash
# 2>&1 –æ–∑–Ω–∞—á–∞–µ—Ç: "fd 2 —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—É–¥–∞ –∂–µ, –∫—É–¥–∞ fd 1"
$ command > output.txt 2>&1

# –ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω!
$ command 2>&1 > output.txt   # stderr –∏–¥—ë—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª!
```

```c
#include <unistd.h>

// dup2(oldfd, newfd) ‚Äî —Å–¥–µ–ª–∞—Ç—å newfd –∫–æ–ø–∏–µ–π oldfd
dup2(fd, STDOUT_FILENO);  // –¢–µ–ø–µ—Ä—å stdout —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ fd
```

### Here documents –∏ here strings

```bash
# Here document
$ cat << EOF
Line 1
Line 2
EOF

# Here string
$ cat <<< "Single line input"
```

---

## 7.5 Pipe: —Å–≤—è–∑—å –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

### –ê–Ω–æ–Ω–∏–º–Ω—ã–µ pipe

```bash
$ ls -la | grep ".txt" | wc -l
```

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ls -la    ‚îÇ ‚îÄ‚îÄ‚ñ∫‚îÇ    grep     ‚îÇ ‚îÄ‚îÄ‚ñ∫‚îÇ    wc -l    ‚îÇ
‚îÇ stdout=pipe ‚îÇ    ‚îÇ stdin=pipe  ‚îÇ    ‚îÇ stdin=pipe  ‚îÇ
‚îÇ             ‚îÇ    ‚îÇ stdout=pipe ‚îÇ    ‚îÇ stdout=tty  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç pipe

```c
#include <unistd.h>

int pipefd[2];
pipe(pipefd);
// pipefd[0] ‚Äî –¥–ª—è —á—Ç–µ–Ω–∏—è
// pipefd[1] ‚Äî –¥–ª—è –∑–∞–ø–∏—Å–∏

// –î–∞–Ω–Ω—ã–µ, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ pipefd[1], —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ pipefd[0]
```

```python
import os

# –°–æ–∑–¥–∞–Ω–∏–µ pipe
read_fd, write_fd = os.pipe()

# –í —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
os.write(write_fd, b"Hello from parent")
os.close(write_fd)

# –í –¥–æ—á–µ—Ä–Ω–µ–º –ø—Ä–æ—Ü–µ—Å—Å–µ (–ø–æ—Å–ª–µ fork)
data = os.read(read_fd, 1024)
print(data)  # b"Hello from parent"
```

### Named pipes (FIFO)

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö, named pipes —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ:

```bash
$ mkfifo /tmp/mypipe

# –¢–µ—Ä–º–∏–Ω–∞–ª 1 (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è —á–∏—Ç–∞—Ç–µ–ª—è)
$ echo "Hello" > /tmp/mypipe

# –¢–µ—Ä–º–∏–Ω–∞–ª 2
$ cat /tmp/mypipe
Hello
```

---

## 7.6 –°–æ–∫–µ—Ç—ã: —Ñ–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –¥–ª—è —Å–µ—Ç–∏

–í Unix **–≤—Å—ë ‚Äî —Ñ–∞–π–ª**, –≤–∫–ª—é—á–∞—è —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –°–æ–∫–µ—Ç (socket) ‚Äî —ç—Ç–æ —Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏, –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –ø–æ —Å–µ—Ç–∏.

### –î–≤–∞ —Ç–∏–ø–∞ —Å–æ–∫–µ—Ç–æ–≤

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Unix Domain Socket | TCP/IP Socket |
|----------------|-------------------|---------------|
| **–ê–¥—Ä–µ—Å–∞—Ü–∏—è** | –ü—É—Ç—å –≤ –§–° (`/tmp/app.sock`) | IP + –ø–æ—Ä—Ç (`127.0.0.1:8080`) |
| **–°–µ—Ç—å** | –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ | –õ–æ–∫–∞–ª—å–Ω–æ –∏ –ø–æ —Å–µ—Ç–∏ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –ë—ã—Å—Ç—Ä–µ–µ (–Ω–µ—Ç TCP-—Å—Ç–µ–∫–∞) | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (IP ‚Üí TCP ‚Üí ...) |
| **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** | –§–∞–π–ª–æ–≤—ã–µ permissions! | –ù–µ—Ç (–ª—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è) |
| **–¢–∏–ø—ã —Ñ–∞–π–ª–∞** | `s` –≤ `ls -l` | –ù–µ –≤–∏–¥–µ–Ω –≤ –§–° |
| **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è** | –Ø–¥—Ä–æ | –Ø–¥—Ä–æ + TCP –±—É—Ñ–µ—Ä—ã |

### Unix Domain Socket ‚Äî —Ñ–∞–π–ª –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ

```bash
# Docker, MySQL, PostgreSQL –∏—Å–ø–æ–ª—å–∑—É—é—Ç unix-—Å–æ–∫–µ—Ç—ã
$ ls -l /var/run/docker.sock
srw-rw---- 1 root docker 0 Feb 14 10:00 /var/run/docker.sock
^                                         ^^^^^^^^^^^^^^^^^^^^^^
—Ç–∏–ø = s (socket)                          –ø—É—Ç—å ‚Äî —ç—Ç–æ –∞–¥—Ä–µ—Å —Å–æ–∫–µ—Ç–∞

# –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤!
$ chmod 660 /var/run/docker.sock     # –¢–æ–ª—å–∫–æ owner –∏ –≥—Ä—É–ø–ø–∞
$ chown root:docker /var/run/docker.sock

# MySQL
$ ls -l /var/run/mysqld/mysqld.sock
srwxrwxrwx 1 mysql mysql 0 Feb 14 10:00 /var/run/mysqld/mysqld.sock
```

```python
import socket

# Unix Domain Socket (SOCK_STREAM = TCP-like, —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π)
server = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
server.bind('/tmp/myapp.sock')  # –ê–¥—Ä–µ—Å ‚Äî –ø—É—Ç—å –≤ –§–°
server.listen(1)

# TCP/IP Socket
server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind(('127.0.0.1', 8080))  # –ê–¥—Ä–µ—Å ‚Äî IP + –ø–æ—Ä—Ç
server.listen(1)
```

### UDP: –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø–æ—Ä—è–¥–∫–∞

```python
# TCP (SOCK_STREAM) ‚Äî —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –±–∞–π—Ç
# –î–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ, –≤ –∫–∞–∫–æ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
tcp = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# UDP (SOCK_DGRAM) ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–∞—Ç–∞–≥—Ä–∞–º–º—ã
# –ü–æ—Ä—è–¥–æ–∫ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω, –¥–æ—Å—Ç–∞–≤–∫–∞ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
udp = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
udp.sendto(b"packet 1", ('127.0.0.1', 9999))
udp.sendto(b"packet 2", ('127.0.0.1', 9999))
# –ü–æ–ª—É—á–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å: packet 2, packet 1 ‚Äî –∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ!

# Unix Domain Socket —Ç–æ–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç SOCK_DGRAM
unix_dgram = socket.socket(socket.AF_UNIX, socket.SOCK_DGRAM)
```

!!! tip "–ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å"
    - **Unix socket** ‚Äî –¥–ª—è —Å–≤—è–∑–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ (Docker, nginx ‚Üî PHP-FPM, PostgreSQL).
      –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ (—Ñ–∞–π–ª–æ–≤—ã–µ –ø—Ä–∞–≤–∞) –∏ –±—ã—Å—Ç—Ä–µ–µ (–Ω–µ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ —Å—Ç–µ–∫–∞).
    - **TCP socket** ‚Äî –¥–ª—è —Å–µ—Ç–µ–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –Ω–∞ –¥—Ä—É–≥–æ–π –º–∞—à–∏–Ω–µ.
    - **UDP socket** ‚Äî –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞, DNS, –∏–≥—Ä ‚Äî –≥–¥–µ —Å–∫–æ—Ä–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏.

---

## 7.7 –õ–∏–º–∏—Ç—ã –∏ —É—Ç–µ—á–∫–∏ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

### –õ–∏–º–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤

```bash
# –ú—è–≥–∫–∏–π –ª–∏–º–∏—Ç (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å)
$ ulimit -n
1024

# –ñ—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç (–º–∞–∫—Å–∏–º—É–º)
$ ulimit -Hn
65536

# –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç (–¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏)
$ ulimit -n 4096

# –°–∏—Å—Ç–µ–º–Ω—ã–π –ª–∏–º–∏—Ç
$ cat /proc/sys/fs/file-max
9223372036854775807
```

### –£—Ç–µ—á–∫–∞ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

```python
# ‚ùå –ü–ª–æ—Ö–æ: —É—Ç–µ—á–∫–∞ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤
def read_file(path):
    f = open(path, 'r')
    return f.read()    # f –Ω–µ –∑–∞–∫—Ä—ã—Ç!

# –ü—Ä–∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–º –≤—ã–∑–æ–≤–µ:
for i in range(10000):
    read_file('file.txt')
# OSError: [Errno 24] Too many open files
```

```python
# ‚úÖ –•–æ—Ä–æ—à–æ: with –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç
def read_file(path):
    with open(path, 'r') as f:
        return f.read()

# ‚úÖ –ò–ª–∏ —è–≤–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å
def read_file(path):
    f = open(path, 'r')
    try:
        return f.read()
    finally:
        f.close()
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –°–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –æ—Ç–∫—Ä—ã—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–º
$ ls /proc/1234/fd | wc -l

# –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –æ—Ç–∫—Ä—ã—Ç—ã
$ lsof -p 1234

# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
$ lsof | awk '{print $2}' | sort | uniq -c | sort -rn | head
```

---

## 7.8 Windows: Handles

### –û—Ç–ª–∏—á–∏—è –æ—Ç Unix

Windows –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **handles** –≤–º–µ—Å—Ç–æ file descriptors:

| Unix | Windows |
|------|---------|
| int fd | HANDLE hFile |
| open() | CreateFile() |
| read() | ReadFile() |
| write() | WriteFile() |
| close() | CloseHandle() |

```c
// Windows API
HANDLE hFile = CreateFile(
    "file.txt",
    GENERIC_READ,
    FILE_SHARE_READ,
    NULL,
    OPEN_EXISTING,
    FILE_ATTRIBUTE_NORMAL,
    NULL
);

char buffer[1024];
DWORD bytesRead;
ReadFile(hFile, buffer, sizeof(buffer), &bytesRead, NULL);

CloseHandle(hFile);
```

### Python –Ω–∞ Windows

```python
# Python –∞–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç —Ä–∞–∑–ª–∏—á–∏—è
# –¢–æ—Ç –∂–µ –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Unix –∏ Windows
with open('file.txt', 'r') as f:
    content = f.read()

# –ü–æ–ª—É—á–∏—Ç—å Windows handle
import msvcrt
handle = msvcrt.get_osfhandle(f.fileno())
```

---

## 7.9 –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### fcntl ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–º

```c
#include <fcntl.h>

// –°–¥–µ–ª–∞—Ç—å –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–º
int flags = fcntl(fd, F_GETFL);
fcntl(fd, F_SETFL, flags | O_NONBLOCK);

// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å close-on-exec
fcntl(fd, F_SETFD, FD_CLOEXEC);
```

```python
import fcntl
import os

# –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ä–µ–∂–∏–º
flags = fcntl.fcntl(fd, fcntl.F_GETFL)
fcntl.fcntl(fd, fcntl.F_SETFL, flags | os.O_NONBLOCK)
```

### –§–∞–π–ª–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (File Locking)

–ö–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–∏–º —Ñ–∞–π–ª–æ–º, –≤–æ–∑–Ω–∏–∫–∞—é—Ç **race conditions**:

```python
# –ü—Ä–æ—Ü–µ—Å—Å A –∏ B –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
count = int(open('counter.txt').read())
count += 1
open('counter.txt', 'w').write(str(count))

# –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤–º–µ—Å—Ç–æ +2 –ø–æ–ª—É—á–∞–µ–º +1 (lost update)
```

**–î–≤–∞ —Ç–∏–ø–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:**

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç |
|-----|----------|------------|
| **Advisory** | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è, –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–æ–ª–∂–Ω—ã —Å–∞–º–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å | `flock`, `fcntl` |
| **Mandatory** | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è, —è–¥—Ä–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø | –†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |

**flock (BSD-—Å—Ç–∏–ª—å):**

```bash
# –í shell ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å flock
$ flock /tmp/my.lock command_to_run

# –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
$ flock -x -w 10 /tmp/my.lock ./script.sh
```

```python
import fcntl

with open('file.txt', 'r+') as f:
    # –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–∂–¥–∞—Ç—å)
    fcntl.flock(f.fileno(), fcntl.LOCK_EX)
    
    # –†–∞–±–æ—Ç–∞–µ–º —Å —Ñ–∞–π–ª–æ–º
    data = f.read()
    f.seek(0)
    f.write(new_data)
    f.truncate()
    
    # –°–Ω—è—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ close)
    fcntl.flock(f.fileno(), fcntl.LOCK_UN)
```

**fcntl (POSIX-—Å—Ç–∏–ª—å):**

```python
import fcntl
import struct

# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –±–∞–π—Ç
lockdata = struct.pack('hhllhh', fcntl.F_WRLCK, 0, 0, 0, 0, 0)
fcntl.fcntl(fd, fcntl.F_SETLKW, lockdata)
```

| –ê—Å–ø–µ–∫—Ç | flock | fcntl |
|--------|-------|-------|
| –ì—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å | –í–µ—Å—å —Ñ–∞–π–ª | –î–∏–∞–ø–∞–∑–æ–Ω –±–∞–π—Ç |
| NFS | –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | –†–∞–±–æ—Ç–∞–µ—Ç |
| –°—Ç–∏–ª—å | BSD | POSIX |

### –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π

POSIX –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:

```python
# O_APPEND ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
# –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ª–æ–≥–æ–≤ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
with open('log.txt', 'a') as f:
    f.write('log entry\n')

# rename() ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Ñ–∞–π–ª–∞
import os
os.rename('new_file.txt', 'target.txt')
```

**–ü–∞—Ç—Ç–µ—Ä–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–ø–∏—Å–∏:**

```python
import os
import tempfile

def atomic_write(path, content):
    """–ó–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª –∞—Ç–æ–º–∞—Ä–Ω–æ: –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ –Ω–∏–∫–∞–∫."""
    dir_name = os.path.dirname(path) or '.'
    
    # 1. –ó–∞–ø–∏—Å–∞—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    fd, tmp = tempfile.mkstemp(dir=dir_name)
    try:
        os.write(fd, content.encode())
        os.fsync(fd)  # 2. –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞ –¥–∏—Å–∫
        os.close(fd)
        os.rename(tmp, path)  # 3. –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
    except:
        os.unlink(tmp)
        raise
```

!!! warning "write() –Ω–µ –≤—Å–µ–≥–¥–∞ –∞—Ç–æ–º–∞—Ä–µ–Ω"
    –ó–∞–ø–∏—Å—å –±–æ–ª—å—à–µ PIPE_BUF (–æ–±—ã—á–Ω–æ 4KB) –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ —á–∞—Å—Ç–∏. –î–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `O_APPEND` –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

### select / poll / epoll ‚Äî –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
import select

# –ñ–¥–∞—Ç—å, –ø–æ–∫–∞ –æ–¥–∏–Ω –∏–∑ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ —Å—Ç–∞–Ω–µ—Ç –≥–æ—Ç–æ–≤
readable, writable, errors = select.select(
    [fd1, fd2],  # –ñ–¥—ë–º —á—Ç–µ–Ω–∏—è
    [fd3],       # –ñ–¥—ë–º –∑–∞–ø–∏—Å–∏
    [],          # –û—à–∏–±–∫–∏
    timeout=5.0  # –¢–∞–π–º–∞—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
)

for fd in readable:
    data = os.read(fd, 1024)
```

### mmap ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ –ø–∞–º—è—Ç—å

```python
import mmap

with open('large_file.bin', 'r+b') as f:
    # –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç—å
    mm = mmap.mmap(f.fileno(), 0)
    
    # –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å –º–∞—Å—Å–∏–≤–æ–º –±–∞–π—Ç
    print(mm[0:10])      # –ü–µ—Ä–≤—ã–µ 10 –±–∞–π—Ç
    mm[0:5] = b'Hello'   # –ó–∞–ø–∏—Å–∞—Ç—å –≤ –Ω–∞—á–∞–ª–æ
    
    mm.close()
```

---

## 7.10 –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞

```python
import os

def copy_file(src, dst, buffer_size=64*1024):
    src_fd = os.open(src, os.O_RDONLY)
    dst_fd = os.open(dst, os.O_WRONLY | os.O_CREAT | os.O_TRUNC, 0o644)
    
    try:
        while True:
            data = os.read(src_fd, buffer_size)
            if not data:
                break
            os.write(dst_fd, data)
    finally:
        os.close(src_fd)
        os.close(dst_fd)
```

### –ü—Ä–∏–º–µ—Ä 1b: os.sendfile ‚Äî –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ user space

`os.sendfile()` –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ **–Ω–∞–ø—Ä—è–º—É—é –≤ —è–¥—Ä–µ** (zero-copy), –º–∏–Ω—É—è user space. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤ –ø–æ —Å–µ—Ç–∏ –∏–ª–∏ –º–µ–∂–¥—É –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞–º–∏:

```python
import os

def copy_file_fast(src, dst):
    """–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ sendfile ‚Äî zero-copy –≤ —è–¥—Ä–µ."""
    src_fd = os.open(src, os.O_RDONLY)
    dst_fd = os.open(dst, os.O_WRONLY | os.O_CREAT | os.O_TRUNC, 0o644)
    
    try:
        # –£–∑–Ω–∞—ë–º —Ä–∞–∑–º–µ—Ä
        size = os.fstat(src_fd).st_size
        # –ö–æ–ø–∏—Ä—É–µ–º –Ω–∞–ø—Ä—è–º—É—é –≤ —è–¥—Ä–µ ‚Äî –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ user space
        os.sendfile(dst_fd, src_fd, 0, size)
    finally:
        os.close(src_fd)
        os.close(dst_fd)
```

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –û–±—ã—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: read() + write()               ‚îÇ
‚îÇ  –î–∏—Å–∫ ‚Üí [—è–¥—Ä–æ] ‚Üí [user space] ‚Üí [—è–¥—Ä–æ] ‚Üí –î–∏—Å–∫        ‚îÇ
‚îÇ         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^              ‚îÇ
‚îÇ         4 –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, 2 –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  sendfile():                                         ‚îÇ
‚îÇ  –î–∏—Å–∫ ‚Üí [—è–¥—Ä–æ] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí [—è–¥—Ä–æ] ‚Üí –î–∏—Å–∫         ‚îÇ
‚îÇ         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^              ‚îÇ
‚îÇ         2 –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, 0 –∫–æ–ø–∏–π –≤ user space‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

!!! info "–ö—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç sendfile / zero-copy"
    - **nginx, Apache** ‚Äî –æ—Ç–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (–¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `sendfile on;`)
    - **Apache Kafka** ‚Äî –∏–º–µ–Ω–Ω–æ zero-copy –¥–µ–ª–∞–µ—Ç Kafka —Ç–∞–∫–æ–π –±—ã—Å—Ç—Ä–æ–π: –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ —Å–µ–≥–º–µ–Ω—Ç–∞
      –ª–æ–≥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—é –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `sendfile()`, –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ user space.
      –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç Kafka –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **–≥–∏–≥–∞–±–∞–π—Ç—ã –≤ —Å–µ–∫—É–Ω–¥—É** –Ω–∞ –æ–±—ã—á–Ω–æ–º –∂–µ–ª–µ–∑–µ.
    - **HAProxy, Envoy** ‚Äî –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏
    - –í Python 3.8+ `shutil.copyfile()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `os.sendfile()` –Ω–∞ Linux
    
    ```
    # nginx.conf
    http {
        sendfile on;      # –í–∫–ª—é—á–∏—Ç—å zero-copy –¥–ª—è –æ—Ç–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤
        tcp_nopush on;    # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ñ–∞–π–ª –æ–¥–Ω–∏–º –ø–∞–∫–µ—Ç–æ–º
    }
    ```

### –ü—Ä–∏–º–µ—Ä 2: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª –∏ —Ç–µ—Ä–º–∏–Ω–∞–ª

```bash
# –í—ã–≤–æ–¥ –≤ —Ñ–∞–π–ª –ò –Ω–∞ —ç–∫—Ä–∞–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
$ command 2>&1 | tee output.log

# –¢–æ –∂–µ —Å–∞–º–æ–µ —Å –ø–æ–º–æ—â—å—é process substitution
$ command > >(tee output.log) 2>&1
```

### –ü—Ä–∏–º–µ—Ä 3: –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å

```python
import os
import tempfile

def atomic_write(path, content):
    # –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    dir_name = os.path.dirname(path) or '.'
    fd, tmp_path = tempfile.mkstemp(dir=dir_name)
    
    try:
        os.write(fd, content.encode())
        os.fsync(fd)  # –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–µ
        os.close(fd)
        os.rename(tmp_path, path)  # –ê—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    except:
        os.unlink(tmp_path)
        raise
```

---

## –†–µ–∑—é–º–µ

| –ü–æ–Ω—è—Ç–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| **fd** | –ß–∏—Å–ª–æ, –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—â–µ–µ –æ—Ç–∫—Ä—ã—Ç—ã–π —Ñ–∞–π–ª –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ |
| **stdin (0)** | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥ |
| **stdout (1)** | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ |
| **stderr (2)** | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ –æ—à–∏–±–æ–∫ |
| **pipe** | –û–¥–Ω–æ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ |
| **dup2()** | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ |

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `cmd > file` | –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å stdout |
| `cmd 2> file` | –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å stderr |
| `cmd &> file` | –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å stdout –∏ stderr |
| `cmd1 \| cmd2` | Pipe –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ |
| `lsof -p PID` | –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ |
| `ulimit -n` | –õ–∏–º–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤ |

!!! warning "–í—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Ñ–∞–π–ª—ã"
    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `with` –≤ Python –∏–ª–∏ `try/finally` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è. –£—Ç–µ—á–∫–∞ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ "Too many open files".

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ –æ—Ç–∫—Ä—ã—Ç—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä

–ï—Å–ª–∏ —Ñ–∞–π–ª –±—ã–ª —É–¥–∞–ª—ë–Ω (`rm`), –Ω–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –≤—Å—ë –µ—â—ë –¥–µ—Ä–∂–∏—Ç –µ–≥–æ –æ—Ç–∫—Ä—ã—Ç—ã–º, –¥–∞–Ω–Ω—ã–µ **–Ω–µ —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã** ‚Äî —è–¥—Ä–æ —Ö—Ä–∞–Ω–∏—Ç inode, –ø–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ—Ç–∫—Ä—ã—Ç—ã–π fd:

```bash
# 1. –ù–∞—Ö–æ–¥–∏–º –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–∂–∏—Ç —É–¥–∞–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª
$ lsof 2>/dev/null | grep '(deleted)'
app    12345  user  3r  REG  8,1  1048576  654321  /var/log/app.log (deleted)
#      ^^^^^            ^^                          ^^^^^^^^^^^^^^^^^
#      PID              fd=3                        —Ñ–∞–π–ª —É–¥–∞–ª—ë–Ω, –Ω–æ fd –æ—Ç–∫—Ä—ã—Ç

# 2. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ /proc —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É
$ cp /proc/12345/fd/3 /var/log/app.log.recovered

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º
$ file /var/log/app.log.recovered
/var/log/app.log.recovered: ASCII text
$ wc -l /var/log/app.log.recovered
52340 /var/log/app.log.recovered
```

!!! tip "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä"
    –≠—Ç–æ —á–∞—Å—Ç–æ —Å–ø–∞—Å–∞–µ—Ç –ª–æ–≥-—Ñ–∞–π–ª—ã: –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–∏—à–µ—Ç –≤ `app.log`, –∞ –∫—Ç–æ-—Ç–æ —Å–ª—É—á–∞–π–Ω–æ
    —É–¥–∞–ª–∏–ª —Ñ–∞–π–ª ‚Äî –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `/proc/<PID>/fd/<N>`, –ø–æ–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å –∂–∏–≤.
    
    –ù–∞ macOS `/proc` –Ω–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `lsof -p <PID>` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –∑–∞—Ç–µ–º
    –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª (–µ—Å–ª–∏ —ç—Ç–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–µ—Ä–≤–µ—Ä —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º).


??? question "–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è"
    **–ó–∞–¥–∞–Ω–∏–µ 1.** –í—ã–ø–æ–ª–Ω–∏—Ç–µ `ls -l /proc/self/fd/` (Linux) –∏–ª–∏ `lsof -p $$` (macOS). –ö–∞–∫–∏–µ —Ñ–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –æ—Ç–∫—Ä—ã—Ç—ã —É –≤–∞—à–µ–≥–æ shell? –ß—Ç–æ –∑–∞ —Ñ–∞–π–ª—ã —Å—Ç–æ—è—Ç –∑–∞ 0, 1, 2?
    
    **–ó–∞–¥–∞–Ω–∏–µ 2.** –ù–∞–ø–∏—à–∏—Ç–µ Python-—Å–∫—Ä–∏–ø—Ç, –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–π 1000 —Ñ–∞–π–ª–æ–≤ –±–µ–∑ –∑–∞–∫—Ä—ã—Ç–∏—è. –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç? –ù–∞–π–¥–∏—Ç–µ –ª–∏–º–∏—Ç: `ulimit -n`. –ü–µ—Ä–µ–ø–∏—à–∏—Ç–µ —Å `with` statement.
    
    **–ó–∞–¥–∞–Ω–∏–µ 3.** –°–æ–∑–¥–∞–π—Ç–µ pipe –º–µ–∂–¥—É –¥–≤—É–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –Ω–∞ Python —Å –ø–æ–º–æ—â—å—é `os.pipe()`: –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –ø–∏—à–µ—Ç, –¥—Ä—É–≥–æ–π —á–∏—Ç–∞–µ—Ç.

!!! tip "–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞"
    –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ñ–∞–π–ª–∞–º–∏ –ø–æ –ø—É—Ç—è–º. –†–∞–∑–±–µ—Ä—ë–º—Å—è —Å **–ø—É—Ç—è–º–∏ –∏ –∏–º–µ–Ω–∞–º–∏ —Ñ–∞–π–ª–æ–≤** ‚Üí [–ü—É—Ç–∏ –∏ –∏–º–µ–Ω–∞](08-paths-names.md)
